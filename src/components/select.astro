---
import { getSelect } from "../api/index.js";
let selectData = await getSelect();
---

<style lang="less">
  #select {
    width: 100%;
    padding-top: 50px;
    scroll-margin-top: 50px;
    @media screen and (max-width: 768px) {
      padding-top: 2rem;
    }
    .boxShadow();
    padding-bottom: 45px;
    font-size: 1.4rem;
    .select-container {
      width: 91%;
      margin: 0 auto;
      @media screen and (max-width: 768px) {
        width: 100%;
      }
      .select-nav {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        border-bottom: 0.8px solid #e5e5e5;
        font-size: 20px;
        font-weight: 700;
        @media screen and (max-width: 768px) {
          width: 91%;
          margin: 0 auto;
        }
        div {
          padding: 30px 60px 30px 0;
          cursor: pointer;
          @media screen and (max-width: 768px) {
            padding: 0 2rem;
            font-size: 1rem;
          }
          &.active {
            color: @bgColor3;
            span {
              &::after {
                width: 100%;
              }
            }
          }
          span {
            border-radius: 20px;
            transition: all 0.3s;
            position: relative;
            &::after {
              content: "";
              position: absolute;
              left: 0;
              right: 0;
              bottom: -14px;
              height: 3px;
              background: #1690ff;
              border-radius: 5px;
              width: 0%;
              transition: width 0.2s ease-in-out;
              @media screen and (max-width: 768px) {
                bottom: -8px;
              }
            }
          }
        }
      }
      .select-content {
        margin-top: 20px;
        @media screen and (max-width: 768px) {
          margin-top: 1rem;
        }
        > div {
          display: none;
          &.active {
            display: block;
          }
        }
        .selectionList {
          .allcontent {
            display: flex;
            width: 100%;
            flex-wrap: wrap;
            .selected-box {
              margin-top: 20px;
              width: 20%;
              position: relative;
              white-space: nowrap;
              .down-icon {
                position: absolute;
                width: 18px;
                height: 18px;
                right: 5%;
                top: 25%;
                cursor: pointer;
                i {
                  background: url("../assets/down-icon.svg");
                  width: 18px;
                  height: 18px;
                  display: inline-block;
                  background-position: 50%;
                  background-size: 133% 133%;
                  transition: all 0.3s;
                  &.active {
                    filter: brightness(0) saturate(100%);
                    transform: rotate(180deg);
                  }
                }
              }
              .selected {
                // display: inline-block;
                border: 0.8px solid #e5e5e5;
                padding: 5px 40px;
                cursor: pointer;
                background-color: rgba(255, 255, 255, 0.3);
                border-radius: 8px 8px 0 0;
              }
              ul {
                position: absolute;
                top: 100%;
                flex-direction: column;
                display: none;
                border: 0.8px solid #e5e5e5;
                .boxLinear();
                border-radius: 0 0 8px 8px;
                z-index: 1;
                width: 100%;
                &.active {
                  display: flex;
                }
                li {
                  padding: 5px 40px;
                  cursor: pointer;
                  &:hover {
                    background-color: rgba(255, 255, 255, 1);
                    color: @bgColor3;
                  }
                }
              }
            }
          }
        }
        .selectionAI {
          p {
            text-align: center;
            padding: 20px 0;
            font-size: 14px;
          }
          .search-input {
            width: 90%;
            height: 75px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            position: relative;
            .search-input {
              border-color: #595959;
              background-color: #fff;
              border: 1px solid #b8b8b8;
              border-radius: 30px;
              color: #191919;
              font-size: 16px;
              height: 56px;
              line-height: 24px;
              outline: none;
              padding: 8px 44px;
              position: absolute;
              z-index: 1001;
              box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.078);
            }
            .close-iocn {
              background-image: url(../assets/cancel-icon.svg);
              background-position: 50% 50%;
              background-repeat: no-repeat;
              background-size: 100%;
              cursor: pointer;
              height: 12px;
              margin-top: -6px;
              position: absolute;
              right: 86px;
              top: 50%;
              width: 12px;
              z-index: 1001;
              transition: all 0.3s;
              &:hover {
                background-image: url(../assets/cancel-icon-h.png);
              }
            }
            .submit-icon {
              background-color: transparent;
              border: none;
              color: #575d6c;
              cursor: pointer;
              height: 18px;
              left: 80px;
              line-height: 0;
              margin-top: -9px;
              outline: none;
              padding: 0;
              position: absolute;
              top: 50%;
              width: 18px;
              z-index: 1001;
              i {
                background: url(../assets/icon_search.svg);
                background-position: 50%;
                background-size: 133% 133%;
                display: inline-block;
                height: 18px;
                width: 18px;
                transition: all 0.2s;
                &:hover {
                  filter: brightness(0) saturate(100%);
                }
              }
            }
          }
        }
      }
    }
  }
</style>
<div id="select">
  <div class="select-container">
    <div class="select-nav">
      <div class="active"><span>选型帮助</span></div>
      <div><span>AI选型</span></div>
    </div>
    <div class="select-content">
      <div class="active selectionList">
        <div class="allcontent">
          {
            Object.entries(selectData).map(([key, value]) => (
              <div class="selected-box" data-key={key}>
                <div class="down-icon">
                  <i class="down-icon-h" />
                </div>
                <div class="selected">{key}</div>
                <ul class="options">
                  {(value as string[]).map((item: string) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </div>
            ))
          }
        </div>
      </div>
      <div class="selectionAI">
        <p>
          输入您的简要消息，通过AI帮助您选型，进一步查阅产品资料，开发指南等信息
        </p>
        <div class="search-input">
          <input
            class="search-input inputSub"
            maxlength="128"
            type="text"
            autocomplete="off"
            placeholder="搜索产品文档、开发指南等"
          />
          <div class="close-iocn"></div>
          <div class="submit-icon">
            <i></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  import $ from "jquery";

  $(function ($) {
    // 缓存选择器
    const $selectNavDivs = $(".select-nav div");
    const $selectContentDivs = $(".select-content > div");
    const $selectedBoxes = $(".selected-box");
    const $options = $(".options");
    const $downIconHs = $(".down-icon-h");
    const $inputSub = $(".inputSub");
    let realTimeValue = "";

    // tab切换
    $selectNavDivs.on("click", function () {
      $(this).addClass("active").siblings().removeClass("active");
      $selectContentDivs
        .eq($(this).index())
        .addClass("active")
        .siblings()
        .removeClass("active");
    });

    // 下拉框切换
    $selectedBoxes.on("click", function () {
      const $option = $(this).find(".options");
      const isActive = $option.hasClass("active");
      $options.removeClass("active");
      $downIconHs.removeClass("active");

      if (!isActive) {
        $option.addClass("active");
        $(this).find(".down-icon-h").addClass("active");
      }
    });

    // 点击空白处关闭下拉框
    $(document).on("click", (event) => {
      if (!$(event.target).closest(".selected-box").length) {
        $options.removeClass("active");
        $downIconHs.removeClass("active");
      }
    });

    // 获取 options 中 li 的值
    $options.on("click", "li", function () {
      const text = $(this).text();
      const $selectedBox = $(this).closest(".selected-box");
      const key = $selectedBox.data("key");
      $selectedBox.find(".selected").text(`${key}：${text}`);
      console.log(`${key}：${text}`);
    });

    // 输入框实时值
    $inputSub.on("input", function () {
      realTimeValue = $(this).val() as string;
    });

    // 关闭输入框
    $(".close-iocn").on("click", function () {
      $inputSub.val("");
      realTimeValue = "";
    });

    // 提交输入框内容
    const handleSubmit = () => {
      if (realTimeValue.trim()) {
        console.log("提交内容：", realTimeValue);
        $inputSub.val("");
        realTimeValue = "";
      }
    };

    // 提交图标点击事件
    $(".submit-icon").on("click", (event) => {
      event.preventDefault();
      handleSubmit();
    });

    // 输入框回车键提交
    $inputSub.on("keypress", (event) => {
      if (event.which === 13 || event.key === "Enter") {
        event.preventDefault();
        handleSubmit();
      }
    });
  });
</script>
